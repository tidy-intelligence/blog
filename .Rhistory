labs(x = NULL, y = "Adjusted Price") +
scale_x_date(expand = c(0, 0), breaks = "5 years") +
scale_y_continuous(breaks = pretty_breaks()) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_x_date(expand = c(0, 0), breaks = "5 years") +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_x_date(expand = c(0, 0), date_breaks = "5 years") +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_x_date() +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
# scale_x_date() +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_x_date(breaks = "5 years") +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_x_date(date_breaks = "5 years") +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_x_date() +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_y_continuous(labels = scales::comma) +
theme_classic()
dax |>
ggplot(aes(x = date, y = price)) +
geom_line() +
labs(x = NULL, y = "Adjusted Price") +
scale_y_continuous(labels = scales::comma)
dax_monthly <- dax |>
mutate(year = year(date),
month = factor(month(date))) |>
group_by(year, month) |>
filter(date == max(date)) |>
ungroup() |>
arrange(date) |>
mutate(ret = price / lag(price) - 1) |>
drop_na()
dax_monthly
factors_ff3_monthly_raw <- download_french_data("Fama/French 3 Factors")
risk_free_monthly <- factors_ff3_monthly_raw$subsets$data[[1]] |>
mutate(
year = year(ymd(str_c(date, "01"))),
month = factor(month(ymd(str_c(date, "01")))),
rf = as.numeric(RF) / 100,
.keep = "none"
)
dax_monthly <- dax_monthly |>
left_join(risk_free_monthly, join_by(year, month)) |>
mutate(ret_excess = ret - rf)
dax_monthly
dax_monthly |>
group_by(month) |>
summarize(ret = mean(ret)) |>
ggplot(aes(x = month, y = ret, fill = ret > 0)) +
geom_col() +
scale_y_continuous(labels = percent) +
labs(
x = "Month", y = "Average DAX Return",
title = "Average monthly DAX returns between 1988 and 2023"
) +
theme(legend.position = "none")
dax_monthly |>
ggplot(aes(x = month, y = ret, group = month)) +
ggdist::stat_halfeye(
adjust = .5, width = .6, .width = 0, justification = -.3, point_colour = NA
) +
geom_boxplot(
width = .25, outlier.shape = NA
) +
stat_summary(
fun = mean, geom="point", color = "red", fill = "red"
) +
geom_point(
size = 1.5, alpha = .2, position = position_jitter(seed = 42, width = .1)
) +
geom_hline(aes(yintercept = 0), linetype = "dashed") +
labs(
x = "Month", y = "DAX Return",
title = "Raincloud plots of monthly DAX returns between 1988 and 2023",
subtitle = "Red dots indicate means"
)
dax_monthly |>
ggplot(aes(x = month, y = ret, group = month)) +
ggdist::stat_halfeye(
adjust = .5, width = .6, .width = 0, justification = -.3, point_colour = NA
) +
geom_boxplot(
width = .25, outlier.shape = NA
) +
stat_summary(
fun = mean, geom="point", color = "red", fill = "red"
) +
geom_point(
size = 1.5, alpha = .2, position = position_jitter(seed = 42, width = .1)
) +
geom_hline(aes(yintercept = 0), linetype = "dashed") +
labs(
x = "Month", y = "DAX Return",
title = "Distributions of monthly DAX returns between 1988 and 2023",
subtitle = "Red dots indicate means, solid lines indicate medians"
)
dax_monthly |>
drop_na(ret_excess) |>
group_by(Month = month) |>
summarize(
Mean = mean(ret_excess),
SD = sd(ret_excess),
Q05 = quantile(ret_excess, 0.05),
Q95 = quantile(ret_excess, 0.95),
`t-Statistic` = sqrt(n()) * mean(ret_excess) / sd(ret_excess)
)
model_monthly <- lm(ret_excess ~ month, data = dax_monthly)
summary(model_monthly, robust = TRUE)
lm(ret_excess ~ month,
data = dax_monthly |>
filter(ret_excess >= quantile(ret_excess, 0.01) &
ret_excess <= quantile(ret_excess, 0.99))
)
dax_monthly
dax_monthly
View(dax_monthly)
dax_monthly <- dax |>
mutate(year = year(date),
month = factor(month(date))) |>
group_by(year, month) |>
filter(date == max(date)) |>
ungroup() |>
arrange(date) |>
mutate(ret = price / lag(price) - 1) |>
drop_na()
#| message: false
factors_ff3_monthly_raw <- download_french_data("Fama/French 3 Factors")
risk_free_monthly <- factors_ff3_monthly_raw$subsets$data[[1]] |>
mutate(
year = year(ymd(str_c(date, "01"))),
month = factor(month(ymd(str_c(date, "01")))),
rf = as.numeric(RF) / 100,
.keep = "none"
)
dax_monthly <- dax_monthly |>
left_join(risk_free_monthly, join_by(year, month)) |>
mutate(ret_excess = ret - rf) |>
drop_na()
lm(ret_excess ~ month,
data = dax_monthly |>
filter(ret_excess >= quantile(ret_excess, 0.01) &
ret_excess <= quantile(ret_excess, 0.99))
)
model_monthly_winsorized <- lm(ret_excess ~ month,
data = dax_monthly |>
filter(ret_excess >= quantile(ret_excess, 0.01) &
ret_excess <= quantile(ret_excess, 0.99))
)
summary(model_monthly_winsorized, robust = TRUE)
halloween_months <- c(11, 12, 1, 2, 3, 4)
halloween_months <- c(11, 12, 1, 2, 3, 4)
seasonality_months <- c(10, 11, 12, 1, 2, 3, 4, 5, 6)
dax_monthly <- dax_monthly |>
mutate(halloween = if_else(month %in% halloween_months, 1L, 0L),
seasonality = if_else(month %in% seasonality_months, 1L, 0L))
model_halloween <- lm(ret_excess ~ halloween, data = dax_monthly)
model_halloween
summary(model_halloween, robust = TRUE)
model_halloween <- lm(ret_excess ~ halloween, data = dax_monthly)
summary(model_halloween, robust = TRUE)
summary(model_monthly_winsorized, robust = TRUE)
library(fixest)
model_monthly <- feols(ret_excess ~ month, data = dax_monthly)
summary(model_monthly, robust = TRUE)
?feols
model_monthly <- feols(
ret_excess ~ month,
data = dax_monthly,
vcov = "hetero"
)
summary(model_monthly)
model_monthly_winsorized <- feols(
ret_excess ~ month,
data = dax_monthly |>
filter(ret_excess >= quantile(ret_excess, 0.01) &
ret_excess <= quantile(ret_excess, 0.99)),
vcov = "hetero"
)
summary(model_monthly_winsorized, robust = TRUE)
summary(model_monthly_winsorized)
etable(model_monthly, model_monthly_winsorized)
?etable
etable(model_monthly, model_monthly_winsorized, coefstat = "tstat")
model_halloween <- feols(
ret_excess ~ halloween,
data = dax_monthly,
vcov = "hetero"
)
model_halloween_winsorized <- feols(
ret_excess ~ halloween,
data = dax_monthly |>
filter(ret_excess >= quantile(ret_excess, 0.01) &
ret_excess <= quantile(ret_excess, 0.99)),
vcov = "hetero"
)
etable(model_halloween, model_halloween_winsorized, coefstat = "tstat")
dax_monthly <- dax_monthly |>
mutate(
ret_excess_halloween = if_else(halloween == 1, ret, rf),
ret_excess_halloween_short = if_else(halloween == 1, ret, -ret)
)
sharpe_ratio <- function(x) {
sqrt(12) *  mean(x) / sd(x)
}
dax_monthly |>
drop_na() |>
arrange(date) |>
summarize(`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short))
dax_monthly |>
drop_na() |>
summarize(`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short))
dax_monthly |>
summarize(`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short))
dax_monthly |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
)
dax_monthly
dax_monthly |>
filter(ret_excess >= ret_excess_q01 &
ret_excess <= ret_excess_q99)
ret_excess_q01 <- quantile(dax_monthly$ret_excess, 0.01)
ret_excess_q99 <- quantile(ret_excess, 0.99)
dax_monthly |>
filter(ret_excess >= ret_excess_q01 &
ret_excess <= ret_excess_q99)
ret_excess_q99 <- quantile(dax_monthly$ret_excess, 0.99)
dax_monthly |>
filter(ret_excess >= ret_excess_q01 &
ret_excess <= ret_excess_q99)
dax_monthly
model_halloween_trimmed <- feols(
ret_excess ~ halloween,
data = dax_monthly |>
filter(ret_excess >= ret_excess_q01 & ret_excess <= ret_excess_q99),
vcov = "hetero"
)
etable(model_halloween, model_halloween_trimmed, coefstat = "tstat")
bind_rows(
dax_monthly |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
),
dax_monthly |>
filter(ret_excess >= ret_excess_q01 & ret_excess <= ret_excess_q99) |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
)
)
dax_monthly |>
filter(ret_excess >= ret_excess_q01 & ret_excess <= ret_excess_q99)
bind_rows(
dax_monthly |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
) |>
mutate(Data = "Full"),
dax_monthly |>
filter(ret_excess >= ret_excess_q01 & ret_excess <= ret_excess_q99) |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
) |>
mutate(Data = "Winsorized")
)
bind_rows(
dax_monthly |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
) |>
mutate(Data = "Full"),
dax_monthly |>
filter(ret_excess >= ret_excess_q01 & ret_excess <= ret_excess_q99) |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
) |>
mutate(Data = "Winsorized")
) |>
select(Data, everything())
dax_monthly <- dax_monthly |>
mutate(
ret_excess_halloween = if_else(halloween == 1, ret_excess, 0),
ret_excess_halloween_short = if_else(halloween == 1, ret_excess, -ret_excess)
)
sharpe_ratio <- function(x) {
sqrt(12) *  mean(x) / sd(x)
}
bind_rows(
dax_monthly |>
summarize(
`Buy and Hold` = sharpe_ratio(ret),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
) |>
mutate(Data = "Full"),
dax_monthly |>
filter(ret_excess >= ret_excess_q01 & ret_excess <= ret_excess_q99) |>
summarize(
`Buy and Hold` = sharpe_ratio(ret_excess),
`Halloween` = sharpe_ratio(ret_excess_halloween),
`Halloween-Short` = sharpe_ratio(ret_excess_halloween_short)
) |>
mutate(Data = "Trimmed")
) |>
select(Data, everything())
#| message: false
#| warning: false
library(dplyr)
library(tidyr)
library(purrr)
library(ggplot2)
dependencies <- c("klaR", "cluster", "scales")
for (package in dependencies) {
if (!require(package, character.only = TRUE, quietly = TRUE)) {
install.packages(package)
}
}
centers <- tibble(
cluster = factor(1:3),
respondents = c(250, 500, 200),
q1 = c(1, 0, 1),
q2 = c(0, 1, 1),
q3 = c(0, 1, 1),
q4 = c(0, 0, 1)
)
set.seed(42)
labelled_respondents <- centers |>
mutate(
across(
starts_with("q"),
~map2(respondents, .x, function(x, y) {
rbinom(x, 1, max((y - 0.1), 0.1))
}),
.names = "{col}"
)
) |>
select(-respondents) |>
unnest(cols = c(q1, q2, q3, q4)) |>
sample_n(n())
?require
package
require(package, character.only = TRUE, quietly = TRUE)
?detach
dependencies <- c("klaR", "cluster", "scales")
for (package in dependencies) {
if (!require(package, character.only = TRUE, quietly = TRUE)) {
install.packages(package)
}
detach(paste0("package:", package), unload=TRUE)
}
package
detach(paste0("package:", package), unload=TRUE)
paste0("package:", package)
detach("package:klaR", unload=TRUE)
dependencies <- c("klaR", "cluster", "scales")
for (package in dependencies) {
if (!require(package, character.only = TRUE, quietly = TRUE)) {
install.packages(package)
}
package <- paste0("package:", package)
detach(package, unload = TRUE)
}
paste0("package:", package)
package
detach(package, character.only = TRUE, unload = TRUE)
#| message: false
#| warning: false
library(dplyr)
library(tidyr)
library(purrr)
library(ggplot2)
dependencies <- c("klaR", "cluster", "scales")
for (package in dependencies) {
if (!require(package, character.only = TRUE, quietly = TRUE)) {
install.packages(package)
}
package <- paste0("package:", package)
detach(package, character.only = TRUE, unload = TRUE)
}
centers <- tibble(
cluster = factor(1:3),
respondents = c(250, 500, 200),
q1 = c(1, 0, 1),
q2 = c(0, 1, 1),
q3 = c(0, 1, 1),
q4 = c(0, 0, 1)
)
set.seed(42)
labelled_respondents <- centers |>
mutate(
across(
starts_with("q"),
~map2(respondents, .x, function(x, y) {
rbinom(x, 1, max((y - 0.1), 0.1))
}),
.names = "{col}"
)
) |>
select(-respondents) |>
unnest(cols = c(q1, q2, q3, q4)) |>
sample_n(n())
detach("MASS", character.only = TRUE, unload = TRUE)
detach("package:MASS", character.only = TRUE, unload = TRUE)
#| message: false
#| warning: false
library(klaR)
library(cluster)
library(dplyr)
library(tidyr)
library(purrr)
library(ggplot2)
library(scales)
centers <- tibble(
cluster = factor(1:3),
respondents = c(250, 500, 200),
q1 = c(1, 0, 1),
q2 = c(0, 1, 1),
q3 = c(0, 1, 1),
q4 = c(0, 0, 1)
)
set.seed(42)
labelled_respondents <- centers |>
mutate(
across(
starts_with("q"),
~map2(respondents, .x, function(x, y) {
rbinom(x, 1, max((y - 0.1), 0.1))
}),
.names = "{col}"
)
) |>
select(-respondents) |>
unnest(cols = c(q1, q2, q3, q4)) |>
sample_n(n())
install.packages("conflicted")
?conflicts_prefer
??conflicts_prefer
library(klaR)
library(cluster)
library(dplyr)
# conflicts_prefer(dplyr::filter)
library(tidyr)
library(purrr)
library(ggplot2)
library(scales)
conflicted::conflict_scout()
library(conflicted)
conflicts_prefer(
dplyr::filter,
dplyr::lag,
dplyr::select
)
