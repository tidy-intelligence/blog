<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.424">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christoph Scheuch">
<meta name="dcterms.date" content="2023-11-24">
<meta name="description" content="On the importance of tidy data for efficient analysis using the analogy of a well-organized kitchen">

<title>Tidy Data: A Recipe for Efficient Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<link href="../../assets/img/favicon.ico" rel="icon">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../../assets/css/styles-global.css">
<link rel="stylesheet" href="../../assets/css/styles-blog.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="https://www.tidy-intelligence.com">
    <span class="navbar-title">Tidy Intelligence</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.tidy-intelligence.com/consulting.html"> 
<span class="menu-text">Consulting</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tidy Data: A Recipe for Efficient Data Analysis</h1>
</div>

<div>
  <div class="description">
    On the importance of tidy data for efficient analysis using the analogy of a well-organized kitchen
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christoph Scheuch </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 24, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Imagine trying to cook a meal in a disorganized kitchen where ingredients are mixed up and nothing is labeled. It would be chaotic and time-consuming to look for the right ingredients and there might be some trial error involved, possibly ruining your planned meal.</p>
<p>Tidy data are like well-organized shelves in your kitchen. Each shelf provides a collection of containers that semantically belong together, e.g., spices or dairies. Each container on the shelf holds one type of ingredient, and the labels on the containers clearly describe what is inside, e.g., pepper or milk. In the same way, tidy data organizes information into a clear and consistent format, where each <strong>type of observational unit forms a table</strong>, <strong>each variable is in a column</strong>, and <strong>each observation is in a row</strong> <span class="citation" data-cites="Wickham2014">(<a href="#ref-Wickham2014" role="doc-biblioref">Wickham 2014</a>)</span>.</p>
<p>Tidying data is about structuring datasets to facilitate analysis, visualization, report generation, or modelling. By following the principle that each variable forms a column, each observation forms a row, and each type of observational unit forms a table, data analysis becomes more intuitive, akin to cooking in a well-organized kitchen where everything has its place and you spend less time on searching for ingredients.</p>
<section id="example-for-tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="example-for-tidy-data">Example for tidy data</h2>
<p>To illustrate the concept of tidy data in our tidy kitchen, suppose we have a table called <code>ingredient</code> that contains information about all the ingredients that we currently have in our kitchen. It might look as follows:</p>
<table class="table">
<thead>
<tr class="header">
<th>name</th>
<th>quantity</th>
<th>unit</th>
<th>category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>flour</td>
<td>500</td>
<td>grams</td>
<td>baking</td>
</tr>
<tr class="even">
<td>sugar</td>
<td>200</td>
<td>grams</td>
<td>baking</td>
</tr>
<tr class="odd">
<td>butter</td>
<td>100</td>
<td>grams</td>
<td>dairy</td>
</tr>
<tr class="even">
<td>eggs</td>
<td>4</td>
<td>units</td>
<td>dairy</td>
</tr>
<tr class="odd">
<td>milk</td>
<td>1</td>
<td>liters</td>
<td>dairy</td>
</tr>
<tr class="even">
<td>salt</td>
<td>10</td>
<td>grams</td>
<td>seasoning</td>
</tr>
<tr class="odd">
<td>olive oil</td>
<td>0.2</td>
<td>liters</td>
<td>oil</td>
</tr>
<tr class="even">
<td>tomatoes</td>
<td>300</td>
<td>grams</td>
<td>vegetable</td>
</tr>
<tr class="odd">
<td>chicken</td>
<td>400</td>
<td>grams</td>
<td>meat</td>
</tr>
<tr class="even">
<td>rice</td>
<td>250</td>
<td>grams</td>
<td>grain</td>
</tr>
</tbody>
</table>
<p>Each row refers to a specific ingredient and each column has a dedicated type and meaning. For instance, the column <code>quantity</code> contains information about how much of the ingredient called <code>name</code> we currently have and which <code>unit</code> we use to measure it.</p>
<p>Similarly, we could have a table just for <code>dairy</code> that might look as follows:</p>
<table class="table">
<thead>
<tr class="header">
<th>name</th>
<th>quantity</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>milk</td>
<td>1</td>
<td>liters</td>
</tr>
<tr class="even">
<td>butter</td>
<td>200</td>
<td>grams</td>
</tr>
<tr class="odd">
<td>yogurt</td>
<td>150</td>
<td>grams</td>
</tr>
<tr class="even">
<td>cheese</td>
<td>100</td>
<td>grams</td>
</tr>
<tr class="odd">
<td>cream</td>
<td>0.5</td>
<td>liters</td>
</tr>
<tr class="even">
<td>cottage cheese</td>
<td>250</td>
<td>grams</td>
</tr>
<tr class="odd">
<td>sour cream</td>
<td>150</td>
<td>grams</td>
</tr>
<tr class="even">
<td>ghee</td>
<td>100</td>
<td>grams</td>
</tr>
<tr class="odd">
<td>whipping cream</td>
<td>0.3</td>
<td>liters</td>
</tr>
<tr class="even">
<td>ice cream</td>
<td>500</td>
<td>grams</td>
</tr>
</tbody>
</table>
<p>Notice that there is no <code>category</code> column in this table? It would actually be redundant to have this column because all rows in the `dairy`` table have the same category.</p>
</section>
<section id="when-colum-headers-are-values-not-variable-names" class="level2">
<h2 class="anchored" data-anchor-id="when-colum-headers-are-values-not-variable-names">When colum headers are values, not variable names</h2>
<p>Now let us move to data structures that are untidy. Consider the following variant of our <code>dairy</code> table:</p>
<table class="table">
<thead>
<tr class="header">
<th>type</th>
<th>liters</th>
<th>grams</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>milk</td>
<td>1</td>
<td></td>
</tr>
<tr class="even">
<td>butter</td>
<td></td>
<td>200</td>
</tr>
<tr class="odd">
<td>yogurt</td>
<td></td>
<td>150</td>
</tr>
<tr class="even">
<td>cheese</td>
<td></td>
<td>100</td>
</tr>
<tr class="odd">
<td>cream</td>
<td>0.5</td>
<td></td>
</tr>
<tr class="even">
<td>cottage cheese</td>
<td></td>
<td>250</td>
</tr>
<tr class="odd">
<td>sour cream</td>
<td></td>
<td>150</td>
</tr>
<tr class="even">
<td>ghee</td>
<td></td>
<td>100</td>
</tr>
<tr class="odd">
<td>whipping cream</td>
<td>0.3</td>
<td></td>
</tr>
<tr class="even">
<td>ice cream</td>
<td></td>
<td>500</td>
</tr>
</tbody>
</table>
<p>What is the issue here? Each row still refers to a specific dairy product. However, instead of dedicated <code>quantity</code> and <code>unit</code> columns, we have a <code>liters</code> and <code>grams</code> column. Since the units differ across dairy products, the table even contains missing values in the form of emtpy cells. So if you want to find out how much of ice cream you still have, you need to also check out the column name. In practice, we would create dedicated <code>quantity</code> and <code>unit</code> columns. we might even decide to have the same unit for all ingredients (e.g., measure everything in grams) and just keep a <code>quantity</code> column.</p>
</section>
<section id="when-multiple-variables-are-stored-in-one-column" class="level2">
<h2 class="anchored" data-anchor-id="when-multiple-variables-are-stored-in-one-column">When multiple variables are stored in one column</h2>
<p>Let us consider the following untidy version of our <code>ingredient</code> table.</p>
<table class="table">
<thead>
<tr class="header">
<th>type</th>
<th>quantity_and_unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>flour</td>
<td>500 grams</td>
</tr>
<tr class="even">
<td>sugar</td>
<td>200 grams</td>
</tr>
<tr class="odd">
<td>butter</td>
<td>100 grams</td>
</tr>
<tr class="even">
<td>eggs</td>
<td>4 units</td>
</tr>
<tr class="odd">
<td>milk</td>
<td>1 liter</td>
</tr>
<tr class="even">
<td>salt</td>
<td>10 grams</td>
</tr>
<tr class="odd">
<td>olive oil</td>
<td>0.2 liters</td>
</tr>
<tr class="even">
<td>tomatoes</td>
<td>300 grams</td>
</tr>
<tr class="odd">
<td>chicken</td>
<td>400 grams</td>
</tr>
<tr class="even">
<td>rice</td>
<td>250 grams</td>
</tr>
</tbody>
</table>
<p>This one is really annoying, since the <code>quantity_and_unit</code> column combines both the quantity and the unit of measurement into one string for each ingredient. Why is this an issue? This format actually makes it harder to perform numerical operations on the quantities or to filter or aggregate the data based on the unit of measurement. So in practice, we would actually start our data analysis by splitting out the <code>quantity_and_unit</code> column into <code>quantity</code> and <code>unit</code>.</p>
</section>
<section id="when-variables-are-stored-in-both-rows-and-columns" class="level2">
<h2 class="anchored" data-anchor-id="when-variables-are-stored-in-both-rows-and-columns">When variables are stored in both rows and columns</h2>
<p>Let us extend our kitchen analogy by additionally considering recipes. For simplicity, a recipe just denotes how much of each ingredient is required. The following table contains two variants of a recipe for pancakes:</p>
<table class="table">
<thead>
<tr class="header">
<th>ingredient</th>
<th>recipe1_quantity</th>
<th>recipe2_quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>flour</td>
<td>500 grams</td>
<td>300 grams</td>
</tr>
<tr class="even">
<td>sugar</td>
<td>200 grams</td>
<td>150 grams</td>
</tr>
<tr class="odd">
<td>butter</td>
<td>100 grams</td>
<td>50 grams</td>
</tr>
<tr class="even">
<td>eggs</td>
<td>4 units</td>
<td>3 units</td>
</tr>
<tr class="odd">
<td>milk</td>
<td>1 liters</td>
<td>0.5 liters</td>
</tr>
</tbody>
</table>
<p>The quantity for each ingredient for two different recipes is stored in separate columns. This structure makes it harder to perform operations like filtering or summarizing the data by recipe or ingredient.</p>
<p>To convert this data to a tidy format, you would typically want to gather the quantities into a single column, and include additional columns to specify the recipe and unit of measurement for each quantity. We can then filer</p>
</section>
<section id="when-there-are-multiple-types-of-data-in-the-same-column" class="level2">
<h2 class="anchored" data-anchor-id="when-there-are-multiple-types-of-data-in-the-same-column">When there are multiple types of data in the same column</h2>
<p>A recipe typically contains information on the required utensils and how much time a step requires. Consider the following table with different types of data:</p>
<table class="table">
<thead>
<tr class="header">
<th>type</th>
<th>quantity</th>
<th>category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>flour</td>
<td>500 grams</td>
<td>ingredient</td>
</tr>
<tr class="even">
<td>butter</td>
<td>100 grams</td>
<td>ingredient</td>
</tr>
<tr class="odd">
<td>whisk</td>
<td>1 unit</td>
<td>utensil</td>
</tr>
<tr class="even">
<td>sugar</td>
<td>200 grams</td>
<td>ingredient</td>
</tr>
<tr class="odd">
<td>baking time</td>
<td>30 minutes</td>
<td>time</td>
</tr>
</tbody>
</table>
<p>The table is trying to describe a recipe but combines different types of data within the same columns. There are ingredients with their quantities, a utensil, and cooking time, all mixed together.</p>
<p>A tidy approach would typically separate these different types of data into separate tables or at least into distinct sets of columns, making it clear what each part of the data represents and facilitating further analysis and visualization.</p>
</section>
<section id="when-some-data-is-missing" class="level2">
<h2 class="anchored" data-anchor-id="when-some-data-is-missing">When some data is missing</h2>
<p>As a last example for untidy data, let us consider the original <code>ingredient</code> table again, but with a few empty cells.</p>
<p>Key points:</p>
<ul>
<li>Huge difference between NA and 0 (or any other value)</li>
<li>Are you sure that you don’t have the ingredient or do you just don’t know?</li>
<li>Missing are dropped in filters</li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>name</th>
<th>quantity</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>flour</td>
<td></td>
<td>grams</td>
</tr>
<tr class="even">
<td>sugar</td>
<td>200</td>
<td>grams</td>
</tr>
<tr class="odd">
<td>butter</td>
<td>100</td>
<td>grams</td>
</tr>
<tr class="even">
<td>eggs</td>
<td>4</td>
<td>units</td>
</tr>
<tr class="odd">
<td>milk</td>
<td>10</td>
<td></td>
</tr>
<tr class="even">
<td>salt</td>
<td>10</td>
<td>grams</td>
</tr>
<tr class="odd">
<td>olive oil</td>
<td>0.2</td>
<td>liters</td>
</tr>
<tr class="even">
<td>tomatoes</td>
<td>300</td>
<td>grams</td>
</tr>
<tr class="odd">
<td>chicken</td>
<td>400</td>
<td>grams</td>
</tr>
<tr class="even">
<td></td>
<td>250</td>
<td>grams</td>
</tr>
</tbody>
</table>
<p>What is the issue here? There are actually a couple of them:</p>
<ul>
<li>The <code>flour</code> row does have any information about <code>quantity</code>, so we just don’t know how much we have.</li>
<li>The <code>milk</code> row does not contain a <code>unit</code>, so we might have 10 liters, 10 milliliters, or 10 cups of milk.</li>
<li>The last row does not have any <code>name</code>, so we have 250 grams of something that we just can’t identify.</li>
</ul>
<p>Why is this important? It makes a huge difference how me treat the missing information. For instance, we might make an educated guess for milk if we always record that information in litres, then the missing unit is very likely litres. For flour, we could play it safe and just say that the available quantity is zero. For the ingredient without a name, we might have to throw it away or ask somebody else to tell us what it is.</p>
<p>Overall, these examples highlight the most important issues that you might have to consider when preparing data for your analysis.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Wickham2014" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“<span class="nocase">Tidy data</span>.”</span> <em><span>Journal of Statistical Software</span></em> 59 (1): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>